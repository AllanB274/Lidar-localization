import numpy as np
import ecal.nanobind_core as ecal_core
from ecal.msg.proto.core import Subscriber as ProtobufSubscriber
from ecal.msg.proto.core import Publisher as ProtobufPublisher
import lidar_data_pb2 as lidar_pb
from ecal.msg.common.core import ReceiveCallbackData
import time

class Point():
    def __init__(self,angle,distance,qualite):
        self.angle=angle
        self.dist=distance
        self.qualite=qualite
        self.x=distance*np.cos(angle)
        self.y=distance*np.sin(angle)
        
class Paquet():
    def __init__(self,L):
        self.nb=len(L)
        self.centre=Point(np.mean([p.angle for p in L]),np.mean([p.dist for p in L]),255)
        self.size=max([distance(p,self.centre) for p in L])

        
def distance(p1,p2):
    return np.sqrt(abs((p2.x)-(p1.x))**2+abs((p2.y)-(p1.y))**2)


def filtre_points(points):
    points_propres=[]
    for p in points:
        if p.dist < np.sqrt(2000**2+3000**2) and p.qualite > 200:
            points_propres.append(p)
    return points_propres


def voisins(eps,points):
    paquets=[]
    traite=[]
    a_traite=[]
    for p in points:
        if p not in traite:
            a_traite.append(p)
            g=[]
            while a_traite !=[]:
                i=a_traite.pop()
                traite.append(i)
                g.append(i)
                for j in points:
                    if j not in traite:
                        if j not in a_traite:
                            if distance(i,j)< eps :
                                a_traite.append(j)
            paquets.append(Paquet(g))
    return paquets

def trouver_balises(paquets):
    for p in paquets:
        for i in paquets:
            if abs(distance(p.centre,i.centre)-np.sqrt(3000**2+1000**2))<100:
                for j in paquets:
                    if j!=p and j!=i:
                        if abs(distance(i.centre,j.centre)-np.sqrt(3000**2+1000**2))<100:
                            if abs(distance(j.centre,p.centre)-2000)<100:
                                return(p,i,j)
                        elif abs(distance(i.centre,j.centre)-2000)<100 :
                            if abs(distance(j.centre,p.centre)-np.sqrt(3000**2+1000**2))<100:
                                return (p,i,j)
    return None

class LidarWatcher:
    def __init__(self):
        if not ecal_core.is_initialized():
            # Initialisation d'ECAL
            ecal_core.initialize("RadarQt receiver")
        
        # Set the state for the program.
        # ecal_core.process.set_state(ecal_core.process.Severity.HEALTHY, ecal_core.process.SeverityLevel.LEVEL1, "I feel good!")

        # Creating eCAL Subscribers
        self.sub = ProtobufSubscriber[lidar_pb.Lidar](lidar_pb.Lidar, "lidar_data")
        self.sub.set_receive_callback(self.data_callback)
        
        self.pub = ProtobufPublisher[lidar_pb.Amalgames](lidar_pb.Amalgames, "amalgames")

    def __enter__(self):
        return self
    
    def __exit__(self, type, value, traceback):
        self.sub.remove_receive_callback()
        ecal_core.finalize()

    def data_callback(self, pub_id : ecal_core.TopicId, data : ReceiveCallbackData[lidar_pb.Lidar]) -> None:
        points=[Point(data.message.angles[i], data.message.distances[i], data.message.quality[i]) for i in range(len(data.message.distances))]
        points_propres=filtre_points(points)                       
        paquets=voisins(50,points_propres)
        self.send_data(paquets)
        
        
        # nb_pts = len(data.message.distances)
        # mean_dist = sum(data.message.distances) / len(data.message.distances)
        # min_angle = data.message.angles[0]
        # max_angle = data.message.angles[-1]
        # print(f"[{min_angle:.2f}-{max_angle:.2f}]{mean_dist: .0f} mm")

    def send_data(self, paquets):
        """Send a LIDAR data message"""
        amal = lidar_pb.Amalgames()
        for paq in paquets:
            centre = paq.centre
            amal.x.extend([centre.x])
            amal.y.extend([centre.y])
            amal.size.extend([paq.size])
        self.pub.send(amal)
        # print(f"{len(paquets)} data sent to ecal!")

# TODO: ajouter fonction qui transforme A, D, Q en liste de Point

if __name__ == "__main__":
    with LidarWatcher() as lw:
        while ecal_core.ok():
            time.sleep(0.5)
    
    D=[12423.0, 0.0, 0.0, 0.0, 13198.0, 0.0, 0.0, 12888.0, 0.0, 0.0, 0.0, 0.0, 142.0, 112.0, 186.0, 186.0, 0.0, 111.0, 93.0, 0.0, 102.0, 129.0, 0.0, 0.0, 0.0, 84.0, 113.0, 115.0, 102.0, 93.0, 10486.0, 156.0, 165.0, 158.0, 169.0, 153.0, 213.0, 0.0, 0.0, 65.0, 92.0, 73.0, 72.0, 88.0, 84.0, 93.0, 0.0, 134.0, 157.0, 186.0, 295.0, 85.0, 96.0, 135.0, 84.0, 94.0, 150.0, 128.0, 57.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 11230.0, 0.0, 0.0, 12516.0, 0.0, 9122.0, 8998.0, 8983.0, 11710.0, 0.0, 0.0, 0.0, 0.0, 11664.0, 11571.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4907.0, 4752.0, 3760.0, 3760.0, 3807.0, 3915.0, 3962.0, 4256.0, 4287.0, 4303.0, 4334.0, 4318.0, 4349.0, 785.0, 785.0, 769.0, 769.0, 754.0, 754.0, 769.0, 769.0, 785.0, 816.0, 6534.0, 6565.0, 6472.0, 6441.0, 12842.0, 12687.0, 111.0, 12408.0, 75.0, 12036.0, 11990.0, 11912.0, 11695.0, 11633.0, 11494.0, 1869.0, 1838.0, 1823.0, 1807.0, 1807.0, 1776.0, 1792.0, 1792.0, 1807.0, 1823.0, 1838.0, 1823.0, 1838.0, 1854.0, 1854.0, 1900.0, 1931.0, 3838.0, 3884.0, 4039.0, 11742.0, 11463.0, 11370.0, 75.0, 6379.0, 6441.0, 6457.0, 115.0, 173.0, 6240.0, 57.0, 9386.0, 9355.0, 9215.0, 8952.0, 4318.0, 4287.0, 4272.0, 4272.0, 4272.0, 4287.0, 4303.0, 4334.0, 4380.0, 8084.0, 7728.0, 4179.0, 4163.0, 4117.0, 4101.0, 4086.0, 4101.0, 4117.0, 4148.0, 4241.0, 4256.0, 6968.0, 6984.0, 3559.0, 3528.0, 3543.0, 3481.0, 3466.0, 3450.0, 3435.0, 3419.0, 3466.0, 3512.0, 3497.0, 3512.0, 6875.0, 6395.0, 6395.0, 1885.0, 1839.0, 1854.0, 1854.0, 6240.0, 6147.0, 6178.0, 6271.0, 6255.0, 6240.0, 4365.0, 4303.0, 4225.0, 4210.0, 4210.0, 4194.0, 4210.0, 4225.0, 4256.0, 4349.0, 4365.0, 6007.0, 6038.0, 6069.0, 6023.0, 6178.0, 6131.0, 6054.0, 6054.0, 6069.0, 6100.0, 6240.0, 6162.0, 6100.0, 6147.0, 6193.0, 6224.0, 6209.0, 6178.0, 6193.0, 6364.0, 6271.0, 6286.0, 6410.0, 6317.0, 6333.0, 6472.0, 6503.0, 6503.0, 6503.0, 6534.0, 6674.0, 1962.0, 1947.0, 1947.0, 1947.0, 6844.0, 6891.0, 6875.0, 7061.0, 7092.0, 7077.0, 7061.0, 7278.0, 7294.0, 7263.0, 7449.0, 4768.0, 4752.0, 4737.0, 4768.0, 4783.0, 4814.0, 7883.0, 8084.0, 8131.0, 8348.0, 4365.0, 4380.0, 4365.0, 4334.0, 4334.0, 4334.0, 4365.0, 4380.0, 4380.0, 9401.0, 9649.0, 9913.0, 9959.0, 9959.0, 4551.0, 4535.0, 4473.0, 4442.0, 4458.0, 4458.0, 4473.0, 4597.0, 4597.0, 10378.0, 10316.0, 10316.0, 11029.0, 11044.0, 11587.0, 11091.0, 11044.0, 10998.0, 11401.0, 11385.0, 11354.0, 1668.0, 1652.0, 1637.0, 1652.0, 1668.0, 11215.0, 11199.0, 11153.0, 11540.0, 12145.0, 2489.0, 2458.0, 2458.0, 2474.0, 9618.0, 5000.0, 4953.0, 4907.0, 4907.0, 4922.0, 4953.0, 5000.0, 5031.0, 11153.0, 11122.0, 3993.0, 3977.0, 3962.0, 3931.0, 3915.0, 3931.0, 3931.0, 3946.0, 3993.0, 4039.0, 4070.0, 9169.0, 9928.0, 8611.0, 8596.0, 8596.0, 8642.0, 8952.0, 9060.0, 5775.0, 5697.0, 5713.0, 5697.0, 3047.0, 3078.0, 3140.0, 3094.0, 3078.0, 3094.0, 3760.0, 3791.0, 3636.0, 3605.0, 3590.0, 3574.0, 3590.0, 3621.0, 3590.0, 3621.0, 7092.0, 7495.0, 7402.0, 7402.0, 8642.0, 7263.0, 7418.0, 8053.0, 8053.0, 8053.0, 7030.0, 7061.0, 8007.0, 7991.0, 6612.0, 7402.0, 8131.0, 8797.0, 7247.0, 7201.0, 8193.0, 8193.0, 8053.0, 7340.0, 8022.0, 8084.0, 8069.0, 8053.0, 8084.0, 8115.0, 8146.0, 7464.0, 6984.0, 8828.0, 8812.0, 8874.0, 9045.0, 9138.0, 9122.0, 9107.0, 9060.0, 9138.0, 9541.0, 9820.0, 10579.0, 10099.0, 9432.0, 8441.0, 8472.0, 8472.0, 8487.0, 8472.0, 7976.0, 8859.0, 8905.0, 8379.0, 9138.0, 9200.0, 9386.0, 9401.0, 10254.0, 9665.0, 9711.0, 10610.0, 9804.0, 8859.0, 8859.0, 10083.0, 10207.0, 9014.0, 9014.0, 10579.0, 10625.0, 9789.0, 11028.0, 11059.0, 11276.0, 9975.0, 10408.0, 11493.0, 11633.0, 10501.0, 10470.0, 10966.0]
    A=[0.00111066410318017, 0.014930498786270618, 0.028750332072377205, 0.042570166289806366, 0.056390002369880676, 0.07020983844995499, 0.0840296670794487, 0.09784950315952301, 0.11166933923959732, 0.12548917531967163, 0.13927727937698364, 0.15203404426574707, 0.1647908091545105, 0.17754758894443512, 0.19030435383319855, 0.20306111872196198, 0.2158178985118866, 0.22857466340065002, 0.24133142828941345, 0.2540881931781769, 0.2668449878692627, 0.2796017527580261, 0.2940879762172699, 0.3085900843143463, 0.32309219241142273, 0.33759427070617676, 0.3520963788032532, 0.3665984869003296, 0.3811005651950836, 0.39560267329216003, 0.41010478138923645, 0.4246068596839905, 0.4391089677810669, 0.4536110758781433, 0.4680972993373871, 0.48183780908584595, 0.4955783188343048, 0.5093188285827637, 0.5230593085289001, 0.5367997884750366, 0.5505403280258179, 0.5642808079719543, 0.5780212879180908, 0.5917618274688721, 0.6055023074150085, 0.6192428469657898, 0.6323328018188477, 0.6460732817649841, 0.6598137617111206, 0.6735543012619019, 0.6872947812080383, 0.7010353207588196, 0.714775800704956, 0.7285162806510925, 0.7422568202018738, 0.7559973001480103, 0.7697377800941467, 0.783478319644928, 0.79726642370224, 0.8112925291061401, 0.8253185749053955, 0.8393446803092957, 0.8533707857131958, 0.867396891117096, 0.8814229965209961, 0.8954491019248962, 0.9094752073287964, 0.9235013127326965, 0.9375274181365967, 0.9515535235404968, 0.96656334400177, 0.9803038239479065, 0.9940443634986877, 1.0077848434448242, 1.0215253829956055, 1.0352658033370972, 1.0490063428878784, 1.0627468824386597, 1.0764873027801514, 1.0902278423309326, 1.1039683818817139, 1.1177088022232056, 1.1307988166809082, 1.144666314125061, 1.1585336923599243, 1.1724010705947876, 1.1862685680389404, 1.2001359462738037, 1.2140034437179565, 1.2278708219528198, 1.2417383193969727, 1.255605697631836, 1.2694731950759888, 1.283340573310852, 1.297128677368164, 1.3108056783676147, 1.324482798576355, 1.3381597995758057, 1.3518368005752563, 1.3655139207839966, 1.3791909217834473, 1.392867922782898, 1.4065449237823486, 1.4202220439910889, 1.4338990449905396, 1.4475760459899902, 1.4688690900802612, 1.4826254844665527, 1.4963818788528442, 1.5101381540298462, 1.5238945484161377, 1.5376509428024292, 1.5514073371887207, 1.5651637315750122, 1.5789200067520142, 1.5926764011383057, 1.6064327955245972, 1.6201891899108887, 1.6332790851593018, 1.6466864347457886, 1.6600936651229858, 1.6735010147094727, 1.6869083642959595, 1.7003155946731567, 1.7137229442596436, 1.7271301746368408, 1.7405375242233276, 1.7539448738098145, 1.7673521041870117, 1.7807594537734985, 1.7945475578308105, 1.8082245588302612, 1.821901559829712, 1.8355786800384521, 1.8492556810379028, 1.8629326820373535, 1.8766098022460938, 1.8902868032455444, 1.9039638042449951, 1.9176408052444458, 1.931317925453186, 1.9449949264526367, 1.9593065977096558, 1.972951889038086, 1.9865971803665161, 2.0002424716949463, 2.013887882232666, 2.0275330543518066, 2.0411784648895264, 2.054823637008667, 2.0684690475463867, 2.0821142196655273, 2.095759630203247, 2.109405040740967, 2.12249493598938, 2.135965585708618, 2.1494364738464355, 2.162907123565674, 2.176378011703491, 2.1898486614227295, 2.203319549560547, 2.216790199279785, 2.2302610874176025, 2.243731737136841, 2.257202625274658, 2.2706732749938965, 2.2842869758605957, 2.2979798316955566, 2.3116726875305176, 2.3253655433654785, 2.3390586376190186, 2.3527514934539795, 2.3664443492889404, 2.3801372051239014, 2.3938300609588623, 2.4075231552124023, 2.4212160110473633, 2.434908866882324, 2.449220657348633, 2.4624056816101074, 2.475590944290161, 2.4887759685516357, 2.5019612312316895, 2.515146493911743, 2.5283315181732178, 2.5415167808532715, 2.554701805114746, 2.5678870677948, 2.5810723304748535, 2.594257354736328, 2.6073474884033203, 2.6211514472961426, 2.634955406188965, 2.648759365081787, 2.6625633239746094, 2.6763672828674316, 2.690171241760254, 2.703975200653076, 2.7177791595458984, 2.7315831184387207, 2.745387077331543, 2.7591910362243652, 2.76861572265625, 2.7823562622070312, 2.7960968017578125, 2.8098373413085938, 2.823577880859375, 2.837318181991577, 2.8510587215423584, 2.8647992610931396, 2.878539800643921, 2.892280340194702, 2.9060208797454834, 2.9197614192962646, 2.933549404144287, 2.947575569152832, 2.961601495742798, 2.9756276607513428, 2.9896538257598877, 3.0036799907684326, 3.0177059173583984, 3.0317320823669434, 3.0457582473754883, 3.059784412384033, 3.073810338973999, 3.087836503982544, 3.1016247272491455, 3.115412712097168, 3.1292006969451904, 3.142988920211792, 3.1567769050598145, 3.170565128326416, 3.1843531131744385, 3.19814133644104, 3.2119293212890625, 3.225717544555664, 3.2395055294036865, 3.253293752670288, 3.2670817375183105, 3.2807271480560303, 3.294372320175171, 3.3080177307128906, 3.3216631412506104, 3.335308313369751, 3.3489537239074707, 3.3625988960266113, 3.376244306564331, 3.3898894786834717, 3.4035348892211914, 3.417180061340332, 3.4307937622070312, 3.444883346557617, 3.458972930908203, 3.473062515258789, 3.487151861190796, 3.501241445541382, 3.5153310298919678, 3.5294206142425537, 3.5435101985931396, 3.5575997829437256, 3.5716893672943115, 3.5857789516448975, 3.6002652645111084, 3.6140055656433105, 3.627746105194092, 3.641486644744873, 3.6552271842956543, 3.6689677238464355, 3.682708263397217, 3.696448802947998, 3.7101891040802, 3.7239296436309814, 3.7376701831817627, 3.751410722732544, 3.764500617980957, 3.777733325958252, 3.790966272354126, 3.804198980331421, 3.817431688308716, 3.8306643962860107, 3.8438973426818848, 3.8571300506591797, 3.8703627586364746, 3.8835954666137695, 3.8968284130096436, 3.9100611209869385, 3.923849105834961, 3.937526226043701, 3.9512033462524414, 3.9648802280426025, 3.9785573482513428, 3.992234468460083, 4.005911350250244, 4.019588470458984, 4.033265590667725, 4.046942710876465, 4.060619354248047, 4.074296474456787, 4.097509384155273, 4.111249923706055, 4.124990463256836, 4.138731002807617, 4.152471542358398, 4.16621208190918, 4.179952621459961, 4.193693161010742, 4.207433700561523, 4.2211737632751465, 4.234914302825928, 4.248654842376709, 4.2619194984436035, 4.275834560394287, 4.289749622344971, 4.303664684295654, 4.317579746246338, 4.3314948081970215, 4.345409870147705, 4.359324932098389, 4.373239994049072, 4.387154579162598, 4.401069641113281, 4.414984703063965, 4.428772926330566, 4.442513465881348, 4.456254005432129, 4.46999454498291, 4.483735084533691, 4.497475624084473, 4.511216163635254, 4.524956703186035, 4.538696765899658, 4.5524373054504395, 4.566177845001221, 4.579918384552002, 4.593532085418701, 4.607621669769287, 4.621711254119873, 4.635800838470459, 4.649890422821045, 4.663980007171631, 4.678069591522217, 4.692159175872803, 4.706248760223389, 4.720338344573975, 4.7344279289245605, 4.7485175132751465, 4.761781692504883, 4.775474548339844, 4.789167404174805, 4.802860736846924, 4.816553592681885, 4.830246448516846, 4.843939304351807, 4.857632160186768, 4.8713250160217285, 4.8850178718566895, 4.89871072769165, 4.912403583526611, 4.9260172843933105, 4.939757823944092, 4.953498363494873, 4.967238903045654, 4.9809794425964355, 4.994719982147217, 5.008460521697998, 5.022200584411621, 5.035941123962402, 5.049681663513184, 5.063422203063965, 5.077162742614746, 5.090950965881348, 5.104532718658447, 5.118114471435547, 5.1316962242126465, 5.145278453826904, 5.158860206604004, 5.1724419593811035, 5.186023712158203, 5.199605464935303, 5.213187217712402, 5.22676944732666, 5.24035120010376, 5.254662990570068, 5.268308162689209, 5.28195333480835, 5.29559850692749, 5.309244155883789, 5.32288932800293, 5.33653450012207, 5.350179672241211, 5.36382532119751, 5.37747049331665, 5.391115665435791, 5.40476131439209, 5.418374538421631, 5.432115077972412, 5.445855617523193, 5.459596157073975, 5.473336696624756, 5.487077236175537, 5.500817775726318, 5.5145583152771, 5.528298854827881, 5.542039394378662, 5.555779457092285, 5.569519996643066, 5.583308219909668, 5.597350120544434, 5.611392021179199, 5.625434398651123, 5.639476299285889, 5.653518199920654, 5.66756010055542, 5.6816020011901855, 5.695643901824951, 5.709685802459717, 5.723728179931641, 5.737770080566406, 5.752081394195557, 5.765821933746338, 5.779562473297119, 5.7933030128479, 5.807043552398682, 5.820784091949463, 5.834524631500244, 5.848265171051025, 5.862005710601807, 5.875746250152588, 5.889486789703369, 5.90322732925415, 5.9133501052856445, 5.927090644836426, 5.940831184387207, 5.954571723937988, 5.9683122634887695, 5.982052326202393, 5.995792865753174, 6.009533405303955, 6.023273944854736, 6.037014484405518, 6.050755023956299, 6.06449556350708, 6.078283786773682, 6.092087745666504, 6.105891704559326, 6.119695663452148, 6.133499622344971, 6.147303581237793, 6.161107540130615, 6.1749114990234375, 6.18871545791626, 6.202519416809082, 6.216323375701904, 6.230127334594727, 6.244439125061035, 6.258243083953857, 6.27204704284668]
    Q=[35.0, 109.0, 80.0, 145.0, 96.0, 77.0, 71.0, 35.0, 22.0, 42.0, 38.0, 51.0, 25.0, 29.0, 16.0, 25.0, 67.0, 25.0, 22.0, 71.0, 16.0, 35.0, 48.0, 42.0, 64.0, 22.0, 16.0, 22.0, 19.0, 32.0, 16.0, 22.0, 12.0, 25.0, 16.0, 12.0, 19.0, 25.0, 25.0, 19.0, 22.0, 12.0, 19.0, 19.0, 22.0, 35.0, 51.0, 22.0, 22.0, 32.0, 22.0, 22.0, 12.0, 25.0, 16.0, 16.0, 16.0, 19.0, 16.0, 96.0, 135.0, 129.0, 109.0, 168.0, 100.0, 135.0, 138.0, 126.0, 96.0, 96.0, 100.0, 135.0, 211.0, 206.0, 155.0, 109.0, 74.0, 145.0, 168.0, 100.0, 132.0, 161.0, 210.0, 211.0, 210.0, 106.0, 213.0, 215.0, 214.0, 218.0, 216.0, 217.0, 211.0, 217.0, 216.0, 215.0, 216.0, 215.0, 211.0, 223.0, 229.0, 232.0, 234.0, 236.0, 235.0, 233.0, 228.0, 226.0, 210.0, 216.0, 215.0, 210.0, 145.0, 90.0, 42.0, 48.0, 35.0, 32.0, 54.0, 32.0, 48.0, 45.0, 35.0, 54.0, 32.0, 228.0, 230.0, 227.0, 224.0, 221.0, 221.0, 226.0, 227.0, 225.0, 226.0, 225.0, 225.0, 222.0, 221.0, 222.0, 212.0, 218.0, 213.0, 142.0, 35.0, 96.0, 80.0, 42.0, 54.0, 61.0, 103.0, 29.0, 29.0, 35.0, 32.0, 106.0, 210.0, 161.0, 119.0, 218.0, 221.0, 222.0, 221.0, 220.0, 220.0, 220.0, 220.0, 211.0, 168.0, 212.0, 217.0, 223.0, 223.0, 222.0, 222.0, 223.0, 221.0, 217.0, 218.0, 216.0, 211.0, 213.0, 210.0, 223.0, 222.0, 221.0, 223.0, 225.0, 221.0, 221.0, 220.0, 224.0, 223.0, 214.0, 177.0, 116.0, 113.0, 219.0, 229.0, 227.0, 224.0, 212.0, 213.0, 211.0, 216.0, 217.0, 212.0, 210.0, 220.0, 217.0, 218.0, 219.0, 216.0, 217.0, 215.0, 214.0, 220.0, 216.0, 215.0, 213.0, 216.0, 215.0, 213.0, 213.0, 217.0, 217.0, 217.0, 210.0, 215.0, 214.0, 216.0, 213.0, 216.0, 215.0, 216.0, 215.0, 211.0, 215.0, 215.0, 212.0, 216.0, 214.0, 213.0, 214.0, 214.0, 215.0, 215.0, 210.0, 214.0, 213.0, 223.0, 225.0, 222.0, 184.0, 212.0, 212.0, 212.0, 213.0, 214.0, 213.0, 206.0, 213.0, 212.0, 213.0, 215.0, 219.0, 218.0, 219.0, 220.0, 212.0, 211.0, 211.0, 151.0, 212.0, 211.0, 221.0, 222.0, 221.0, 221.0, 220.0, 220.0, 221.0, 213.0, 177.0, 200.0, 171.0, 148.0, 190.0, 216.0, 218.0, 217.0, 220.0, 221.0, 218.0, 217.0, 217.0, 219.0, 193.0, 210.0, 135.0, 190.0, 197.0, 184.0, 190.0, 211.0, 210.0, 174.0, 168.0, 174.0, 211.0, 218.0, 219.0, 219.0, 213.0, 80.0, 206.0, 210.0, 74.0, 61.0, 211.0, 225.0, 224.0, 216.0, 177.0, 213.0, 220.0, 220.0, 217.0, 218.0, 217.0, 213.0, 138.0, 211.0, 174.0, 219.0, 220.0, 222.0, 221.0, 220.0, 219.0, 220.0, 219.0, 218.0, 220.0, 148.0, 84.0, 145.0, 215.0, 212.0, 214.0, 212.0, 190.0, 177.0, 211.0, 217.0, 216.0, 217.0, 106.0, 210.0, 148.0, 67.0, 84.0, 35.0, 171.0, 211.0, 217.0, 218.0, 218.0, 217.0, 217.0, 219.0, 218.0, 211.0, 158.0, 151.0, 206.0, 96.0, 109.0, 213.0, 155.0, 214.0, 216.0, 211.0, 213.0, 211.0, 213.0, 161.0, 211.0, 106.0, 214.0, 212.0, 142.0, 212.0, 212.0, 211.0, 211.0, 214.0, 142.0, 214.0, 216.0, 216.0, 215.0, 211.0, 213.0, 212.0, 87.0, 171.0, 158.0, 184.0, 211.0, 212.0, 213.0, 212.0, 142.0, 213.0, 132.0, 135.0, 54.0, 106.0, 211.0, 213.0, 216.0, 215.0, 216.0, 213.0, 212.0, 164.0, 210.0, 200.0, 171.0, 197.0, 142.0, 132.0, 212.0, 96.0, 158.0, 84.0, 116.0, 180.0, 164.0, 200.0, 203.0, 90.0, 184.0, 122.0, 177.0, 148.0, 155.0, 161.0, 155.0, 96.0, 129.0, 164.0, 100.0, 67.0, 122.0, 168.0]

    points=[Point(A[i],D[i],Q[i]) for i in range(len(A))]
    points_propres=filtre_points(points)                       
    paquets=voisins(50,points_propres)

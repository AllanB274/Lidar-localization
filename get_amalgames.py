import numpy as np
import matplotlib.pyplot as plt

class Point():
    def __init__(self,angle,distance,qualite):
        self.angle=angle
        self.dist=distance
        self.qualite=qualite
        self.x=distance*np.cos(angle)
        self.y=distance*np.sin(angle)
        
class Paquet():
    def __init__(self,L):
        self.nb=len(L)
        self.centre=Point(np.mean([p.angle for p in L]),np.mean([p.dist for p in L]),255)
        self.size=max([distance(p,self.centre) for p in L])

        
def distance(p1,p2):
    return np.sqrt(abs((p2.x)-(p1.x))**2+abs((p2.y)-(p1.y))**2)


def filtre_points(points):
    points_propres=[]
    for p in points:
        if p.dist < np.sqrt(2000**2+3000**2) and p.dist > 10 and p.qualite > 200:
            points_propres.append(p)
    return points_propres

def filtre_paquets(paquets,res):
    paquets_filtres=[]
    alpha=res*(np.pi/180)
    for p in paquets:
        nb_max=1+(100//(2*p.centre.dist*np.sin(alpha/2)))
        if p.nb<=nb_max:
            paquets_filtres.append(p)
    return paquets_filtres

res=0.7 #résolution angulaire. elle est normalement de 0.788 mais on en est pas sûr. à remplacer si plus d'information sur la précision angulaire

def voisins(eps,points):
    paquets=[]
    traite=[]
    a_traiter=[]
    for p in points:
        if p not in traite:
            a_traiter.append(p)
            g=[]
            while a_traiter !=[]:
                i=a_traiter.pop()
                traite.append(i)
                g.append(i)
                for j in points:
                    if j not in traite:
                        if j not in a_traiter:
                            if distance(i,j)< eps :
                                a_traiter.append(j)
            paquets.append(Paquet(g))
    return paquets

def trouver_balises(paquets, eps=250):
    # balises : list of (p, i, j, d), p, i, j les trois points du triangle et d la somme des erreurs de distance
    balises = []
    for p in paquets:
        for i in paquets:
            if abs(distance(p.centre,i.centre)-np.sqrt(3000**2+1000**2))<eps:
                for j in paquets:
                    if j!=p and j!=i:
                        dij = distance(i.centre, j.centre)
                        djp = distance(j.centre, p.centre)
                        if abs(dij-np.sqrt(3000**2+1000**2))<eps:
                            if abs(djp-2000)<eps:
                                balises.append(p,i,j, abs(dij-np.sqrt(3000**2+1000**2))+abs(djp-2000))
                        elif abs(dij-2000)<eps:
                            if abs(djp-np.sqrt(3000**2+1000**2))<eps:
                                balises.append(p,i,j, abs(djp-np.sqrt(3000**2+1000**2))+abs(dij-2000))
    return None if len(balises)==0 else balises

def rectangulisation(balises):
    
    def R(theta):
        # Matrice de rotation dans le sens inverse (peu importe)
        return np.matrix([[np.cos(theta), np.sin(theta)], [-np.sin(theta), np.cos(theta)]])
    
    distances = []
    for b in balises:
        for bb in balises:
            if b!=bb:
                distances.append(distance(b.centre, bb.centre))
    d = min(distances)          # base du triangle
    r = (sum(distances)-d)/2    # moyenne des deux autres côtés (censé être égaux car isocèle)
    theta = np.asin(d/2/r)      # angle de rotation a effectuer
    rotated = R(theta)@np.matrix([[b.centre.x for b in balises], [b.centre.y for b in balises]])
    rotated = np.array(rotated)
    minx, maxx = min(rr[0]), max(rr[0])
    miny, maxy = min(rr[1]), max(rr[1])
    return (minx, maxx, miny, maxy)

def robot_in_balises(balises):
    # Renvoie vrai si le robot est dans les balises
    minx, maxx, miny, maxy = rectangulisation(balises)
    return minx*maxx<0 and miny*maxy<0      # il suffit de tester que le rectangle coupe bien l'abscisse et l'ordonée

def choix_balises(balises_list):
    balises_list = [balises for balises in balises_list if robot_in_balises(balises)]
    balises_list.sort(key=lambda x: x[3])
    return balises_list[0] if len(balises_list)>0 else None

if __name__ == "__main__":
    
    A=[0.005331187509000301, 0.019008222967386246, 0.032685257494449615, 0.046362292021512985, 0.060039326548576355, 0.07435102760791779, 0.08799632638692856, 0.10164163261651993, 0.1152869313955307, 0.12893223762512207, 0.14257752895355225, 0.15622283518314362, 0.16986814141273499, 0.18351343274116516, 0.19715873897075653, 0.2108040452003479, 0.22444933652877808, 0.23753930628299713, 0.25132742524147034, 0.26511549949645996, 0.278903603553772, 0.292691707611084, 0.306479811668396, 0.320267915725708, 0.33405601978302, 0.34784412384033203, 0.36163222789764404, 0.37542033195495605, 0.38920843601226807, 0.4029965102672577, 0.4170385003089905, 0.4310804605484009, 0.4451224207878113, 0.4591643810272217, 0.47320637106895447, 0.48724833130836487, 0.5012903213500977, 0.5153322815895081, 0.5293742418289185, 0.5434162020683289, 0.5574581623077393, 0.5705481171607971, 0.5842886567115784, 0.5980291366577148, 0.6117696166038513, 0.6255101561546326, 0.639250636100769, 0.6529911160469055, 0.6667316555976868, 0.6804721355438232, 0.6942126154899597, 0.707953155040741, 0.7216936349868774, 0.7347835898399353, 0.7485876083374023, 0.7623915672302246, 0.7761955261230469, 0.7899994850158691, 0.8038034439086914, 0.8176074028015137, 0.8314113616943359, 0.845215380191803, 0.8590193390846252, 0.8728232979774475, 0.8866272568702698, 0.9002408385276794, 0.9138861298561096, 0.9275314211845398, 0.94117671251297, 0.9548220634460449, 0.9684673547744751, 0.9821126461029053, 0.9957579374313354, 1.0094032287597656, 1.0230485200881958, 1.036693811416626, 1.0503391027450562, 1.0639526844024658, 1.0777724981307983, 1.0915924310684204, 1.105412244796753, 1.1192320585250854, 1.133051872253418, 1.1468716859817505, 1.160691499710083, 1.174511432647705, 1.1883312463760376, 1.2021510601043701, 1.2159708738327026, 1.2295844554901123, 1.2433884143829346, 1.2571923732757568, 1.270996332168579, 1.2848002910614014, 1.2986042499542236, 1.312408208847046, 1.3262122869491577, 1.34001624584198, 1.3538202047348022, 1.3676241636276245, 1.3814281225204468, 1.3952162265777588, 1.4093058109283447, 1.4233953952789307, 1.437484860420227, 1.451574444770813, 1.465664029121399, 1.4797536134719849, 1.4938431978225708, 1.5079327821731567, 1.5220223665237427, 1.536111831665039, 1.550201416015625, 1.5638149976730347, 1.5775078535079956, 1.591200828552246, 1.604893684387207, 1.6185866594314575, 1.6322795152664185, 1.6459723711013794, 1.6596653461456299, 1.6733582019805908, 1.6870511770248413, 1.7007440328598022, 1.7144368886947632, 1.730668544769287, 1.744424819946289, 1.7581812143325806, 1.771937608718872, 1.7856940031051636, 1.7994502782821655, 1.813206672668457, 1.8269630670547485, 1.84071946144104, 1.8544758558273315, 1.8682321310043335, 1.881988525390625, 1.8950785398483276, 1.9080256223678589, 1.9209728240966797, 1.9339200258255005, 1.9468672275543213, 1.9598143100738525, 1.9727615118026733, 1.9857087135314941, 1.998655915260315, 2.0116031169891357, 2.024550199508667, 2.0374972820281982, 2.0512855052948, 2.064962387084961, 2.078639507293701, 2.0923166275024414, 2.1059935092926025, 2.1196706295013428, 2.133347749710083, 2.147024631500244, 2.1607017517089844, 2.1743788719177246, 2.1880557537078857, 2.201732873916626, 2.216219186782837, 2.229118585586548, 2.242018222808838, 2.254917860031128, 2.267817258834839, 2.280716896057129, 2.293616533279419, 2.306516170501709, 2.31941556930542, 2.33231520652771, 2.34521484375, 2.358114242553711, 2.371204376220703, 2.384897232055664, 2.398590087890625, 2.412282943725586, 2.425976037979126, 2.439668893814087, 2.453361749649048, 2.467054605484009, 2.4807474613189697, 2.4944403171539307, 2.5081334114074707, 2.5218262672424316, 2.5354397296905518, 2.549132823944092, 2.5628256797790527, 2.5765185356140137, 2.5902113914489746, 2.6039042472839355, 2.6175971031188965, 2.6312901973724365, 2.6449830532073975, 2.6586759090423584, 2.6723687648773193, 2.6860616207122803, 2.700373411178589, 2.714177370071411, 2.7279813289642334, 2.7417852878570557, 2.755589246749878, 2.7693932056427, 2.7831971645355225, 2.7970011234283447, 2.810805082321167, 2.8246090412139893, 2.8384130001068115, 2.852216958999634, 2.8654816150665283, 2.879269599914551, 2.8930578231811523, 2.906845808029175, 2.9206340312957764, 2.934422016143799, 2.9482102394104004, 2.961998224258423, 2.9757864475250244, 2.989574432373047, 3.0033626556396484, 3.017150640487671, 3.0304152965545654, 3.0440921783447266, 3.057769298553467, 3.071446180343628, 3.085123300552368, 3.0988004207611084, 3.1124773025512695, 3.1261544227600098, 3.13983154296875, 3.153508424758911, 3.1671855449676514, 3.1808626651763916, 3.1953487396240234, 3.2094383239746094, 3.2235279083251953, 3.2376174926757812, 3.251707077026367, 3.265796661376953, 3.279886245727539, 3.293975830078125, 3.308065414428711, 3.322154998779297, 3.336244583129883, 3.3503339290618896, 3.363947629928589, 3.37768816947937, 3.3914287090301514, 3.4051690101623535, 3.4189095497131348, 3.432650089263916, 3.4463906288146973, 3.4601311683654785, 3.4738717079162598, 3.487612009048462, 3.501352548599243, 3.5150930881500244, 3.528881311416626, 3.5425264835357666, 3.5561718940734863, 3.569817066192627, 3.5834624767303467, 3.5971076488494873, 3.610753059387207, 3.6243982315063477, 3.6380436420440674, 3.651688814163208, 3.6653342247009277, 3.6789796352386475, 3.6925930976867676, 3.706174850463867, 3.719756841659546, 3.7333385944366455, 3.746920347213745, 3.760502338409424, 3.7740840911865234, 3.787665843963623, 3.8012478351593018, 3.8148295879364014, 3.828411340713501, 3.8419933319091797, 3.855781316757202, 3.8695852756500244, 3.8833892345428467, 3.897193193435669, 3.910997152328491, 3.9248011112213135, 3.938605308532715, 3.952409267425537, 3.9662132263183594, 3.9800171852111816, 3.993821144104004, 4.007625102996826, 4.021238803863525, 4.0358357429504395, 4.050433158874512, 4.065030574798584, 4.079627990722656, 4.09422492980957, 4.108822345733643, 4.123419761657715, 4.138017177581787, 4.152614116668701, 4.167211532592773, 4.181808948516846, 4.195597171783447, 4.2094645500183105, 4.223331928253174, 4.237199306488037, 4.2510666847229, 4.264934062957764, 4.278801441192627, 4.29266881942749, 4.306536674499512, 4.320404052734375, 4.334271430969238, 4.348138809204102, 4.36245059967041, 4.376143455505371, 4.389836311340332, 4.403529167175293, 4.417222023010254, 4.430914878845215, 4.444607734680176, 4.458300590515137, 4.471993446350098, 4.485686779022217, 4.499379634857178, 4.513072490692139, 4.52668571472168, 4.540379047393799, 4.55407190322876, 4.567764759063721, 4.581457614898682, 4.595150470733643, 4.6088433265686035, 4.6225361824035645, 4.636229038238525, 4.649921894073486, 4.663614749908447, 4.677308082580566, 4.69109582901001, 4.70472526550293, 4.71835470199585, 4.7319841384887695, 4.7456135749816895, 4.759243011474609, 4.772872447967529, 4.786501884460449, 4.800131320953369, 4.813760757446289, 4.827390193939209, 4.841019630432129, 4.8553314208984375, 4.868976593017578, 4.882622241973877, 4.896267414093018, 4.909912586212158, 4.923557758331299, 4.937203407287598, 4.950848579406738, 4.964493751525879, 4.9781389236450195, 4.991784572601318, 5.005429744720459, 5.018519878387451, 5.032672882080078, 5.046825885772705, 5.060978889465332, 5.075131893157959, 5.089284896850586, 5.103437900543213, 5.11759090423584, 5.131743907928467, 5.145896911621094, 5.160049915313721, 5.174202919006348, 5.187816619873047, 5.201620578765869, 5.215424537658691, 5.229228496551514, 5.243032455444336, 5.256836414337158, 5.2706403732299805, 5.284444332122803, 5.298248291015625, 5.312052249908447, 5.3258562088012695, 5.339660167694092, 5.352750301361084, 5.366332054138184, 5.379913806915283, 5.393495559692383, 5.407077789306641, 5.42065954208374, 5.43424129486084, 5.4478230476379395, 5.461404800415039, 5.474987030029297, 5.4885687828063965, 5.502150535583496, 5.515938758850098, 5.529171466827393, 5.5424041748046875, 5.555636882781982, 5.568869590759277, 5.582102298736572, 5.595335006713867, 5.608567714691162, 5.621800899505615, 5.63503360748291, 5.648266315460205, 5.6614990234375, 5.675287246704102, 5.689027786254883, 5.702768325805664, 5.716508865356445, 5.730248928070068, 5.74398946762085, 5.757730007171631, 5.771470546722412, 5.785211086273193, 5.798951625823975, 5.812692165374756, 5.826432704925537, 5.840220928192139, 5.854706764221191, 5.869193077087402, 5.883679389953613, 5.898165702819824, 5.912652015686035, 5.927138328552246, 5.941624164581299, 5.95611047744751, 5.970596790313721, 5.985083103179932, 5.999569416046143, 6.013182640075684, 6.026987075805664, 6.040791034698486, 6.054594993591309, 6.068398952484131, 6.082202911376953, 6.096006870269775, 6.109810829162598, 6.12361478805542, 6.137418746948242, 6.1512227058410645, 6.165026664733887, 6.172008037567139, 6.185795783996582, 6.199584007263184, 6.213372230529785, 6.227160453796387, 6.24094820022583, 6.254736423492432, 6.268524646759033, 6.282312870025635]
    D=[10056.0, 10072.0, 9653.0, 5701.0, 5670.0, 5639.0, 5639.0, 5639.0, 8956.0, 8615.0, 8506.0, 8537.0, 8119.0, 8243.0, 7902.0, 5856.0, 4787.0, 4709.0, 4663.0, 4601.0, 3903.0, 3903.0, 3872.0, 3841.0, 1873.0, 1842.0, 1842.0, 1858.0, 3934.0, 3919.0, 3950.0, 6662.0, 6755.0, 6631.0, 6631.0, 6399.0, 6368.0, 6461.0, 6507.0, 183.0, 190.0, 5934.0, 6027.0, 6414.0, 6213.0, 6166.0, 6042.0, 6073.0, 6151.0, 6120.0, 6135.0, 5934.0, 5980.0, 5965.0, 6058.0, 5856.0, 5856.0, 5903.0, 5841.0, 5887.0, 5918.0, 5934.0, 5779.0, 5794.0, 5856.0, 5779.0, 5779.0, 5918.0, 5794.0, 5779.0, 5794.0, 5794.0, 5918.0, 5934.0, 5810.0, 5779.0, 5825.0, 5872.0, 3733.0, 3686.0, 3655.0, 3609.0, 1517.0, 1501.0, 1501.0, 1517.0, 1532.0, 3671.0, 3717.0, 3795.0, 6073.0, 6073.0, 6058.0, 6042.0, 6104.0, 6213.0, 6166.0, 6166.0, 6290.0, 3919.0, 3872.0, 3857.0, 3872.0, 3872.0, 3857.0, 3872.0, 6538.0, 6553.0, 6755.0, 6755.0, 6739.0, 6910.0, 6894.0, 6894.0, 7080.0, 7034.0, 7096.0, 3268.0, 3283.0, 3283.0, 3237.0, 3221.0, 3221.0, 3221.0, 3237.0, 2772.0, 2586.0, 2632.0, 2632.0, 2586.0, 8413.0, 8723.0, 8863.0, 8816.0, 3516.0, 3469.0, 3423.0, 3407.0, 3423.0, 3531.0, 3531.0, 3547.0, 3578.0, 3562.0, 4182.0, 9917.0, 9917.0, 4043.0, 3965.0, 3950.0, 3950.0, 3965.0, 3981.0, 4058.0, 11048.0, 4089.0, 4120.0, 10428.0, 10428.0, 10722.0, 10707.0, 10738.0, 10536.0, 10474.0, 10474.0, 3299.0, 3283.0, 3268.0, 3206.0, 3190.0, 3175.0, 3175.0, 3190.0, 3190.0, 3206.0, 3268.0, 3268.0, 1873.0, 1858.0, 1858.0, 1873.0, 9886.0, 8925.0, 8894.0, 8894.0, 8894.0, 10552.0, 10505.0, 8677.0, 8692.0, 8723.0, 8723.0, 9901.0, 4554.0, 4492.0, 4461.0, 4446.0, 4430.0, 4461.0, 4508.0, 4539.0, 10738.0, 8119.0, 974.0, 959.0, 943.0, 943.0, 959.0, 959.0, 974.0, 8274.0, 8336.0, 7933.0, 7871.0, 7855.0, 7886.0, 7979.0, 6801.0, 6755.0, 6770.0, 6786.0, 6879.0, 7189.0, 7142.0, 7158.0, 6631.0, 6522.0, 6941.0, 6662.0, 7096.0, 7111.0, 7049.0, 7065.0, 7065.0, 7096.0, 6244.0, 7096.0, 7080.0, 7065.0, 7716.0, 6910.0, 6786.0, 6786.0, 7731.0, 6352.0, 6321.0, 7266.0, 7995.0, 8026.0, 8010.0, 6352.0, 6383.0, 7886.0, 7886.0, 7235.0, 7282.0, 7995.0, 7979.0, 7979.0, 6662.0, 8041.0, 8057.0, 8072.0, 7421.0, 6801.0, 6848.0, 9157.0, 9002.0, 7375.0, 8894.0, 9033.0, 8971.0, 9126.0, 9653.0, 10320.0, 10025.0, 9390.0, 8475.0, 8522.0, 8568.0, 8630.0, 8630.0, 8661.0, 8026.0, 8925.0, 8475.0, 8429.0, 9266.0, 9467.0, 8646.0, 7778.0, 7793.0, 8956.0, 9932.0, 9932.0, 9080.0, 9049.0, 8150.0, 10459.0, 9312.0, 8460.0, 10784.0, 9545.0, 11296.0, 11327.0, 11404.0, 11404.0, 10242.0, 11745.0, 11900.0, 10893.0, 11389.0, 11311.0, 12691.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13295.0, 0.0, 0.0, 0.0, 0.0, 0.0, 116.0, 0.0, 0.0, 171.0, 190.0, 0.0, 141.0, 107.0, 134.0, 0.0, 133.0, 90.0, 101.0, 68.0, 130.0, 109.0, 139.0, 126.0, 118.0, 102.0, 89.0, 98.0, 602.0, 75.0, 71.0, 81.0, 83.0, 68.0, 57.0, 54.0, 65.0, 70.0, 61.0, 0.0, 12722.0, 312.0, 148.0, 217.0, 0.0, 84.0, 88.0, 61.0, 79.0, 61.0, 258.0, 95.0, 148.0, 80.0, 0.0, 0.0, 0.0, 0.0, 10862.0, 10707.0, 10676.0, 0.0, 0.0, 11947.0, 0.0, 9297.0, 9374.0, 0.0, 0.0, 0.0, 11869.0, 0.0, 0.0, 11714.0, 11807.0, 9452.0, 9405.0, 9405.0, 9498.0, 1393.0, 1377.0, 1362.0, 1362.0, 1362.0, 1377.0, 4461.0, 4461.0, 4446.0, 4461.0, 4477.0, 4508.0, 4694.0, 0.0, 11668.0, 11699.0, 98.0, 7096.0, 7111.0, 7189.0, 0.0, 0.0, 0.0, 0.0, 13249.0, 13078.0, 12939.0, 2323.0, 2307.0, 2307.0, 2261.0, 2261.0, 2276.0, 2276.0, 2276.0, 2245.0, 2245.0, 2276.0, 2292.0, 2307.0, 2338.0, 6244.0, 3733.0, 3640.0, 3609.0, 3578.0, 3562.0, 3562.0, 3593.0, 3609.0, 3640.0, 3671.0, 3733.0, 12427.0, 116.0, 6755.0, 6801.0, 6755.0, 6584.0, 6553.0]
    Q=[197.0, 197.0, 210.0, 213.0, 218.0, 219.0, 221.0, 214.0, 106.0, 200.0, 210.0, 211.0, 211.0, 187.0, 210.0, 213.0, 218.0, 218.0, 220.0, 217.0, 222.0, 223.0, 220.0, 221.0, 219.0, 227.0, 224.0, 224.0, 215.0, 221.0, 213.0, 216.0, 215.0, 212.0, 213.0, 215.0, 215.0, 215.0, 210.0, 22.0, 29.0, 25.0, 29.0, 122.0, 216.0, 213.0, 215.0, 211.0, 214.0, 214.0, 210.0, 213.0, 214.0, 214.0, 213.0, 212.0, 212.0, 215.0, 214.0, 212.0, 214.0, 214.0, 214.0, 215.0, 217.0, 217.0, 212.0, 217.0, 214.0, 216.0, 216.0, 216.0, 211.0, 218.0, 214.0, 217.0, 213.0, 216.0, 212.0, 221.0, 222.0, 214.0, 224.0, 226.0, 227.0, 222.0, 212.0, 216.0, 216.0, 217.0, 213.0, 215.0, 214.0, 215.0, 210.0, 214.0, 215.0, 212.0, 213.0, 213.0, 218.0, 218.0, 218.0, 217.0, 218.0, 215.0, 213.0, 213.0, 187.0, 213.0, 212.0, 212.0, 213.0, 211.0, 215.0, 213.0, 210.0, 219.0, 220.0, 220.0, 220.0, 222.0, 223.0, 222.0, 214.0, 80.0, 119.0, 210.0, 151.0, 122.0, 213.0, 138.0, 211.0, 212.0, 218.0, 219.0, 218.0, 220.0, 218.0, 220.0, 219.0, 220.0, 221.0, 210.0, 210.0, 210.0, 200.0, 216.0, 218.0, 219.0, 220.0, 219.0, 219.0, 214.0, 155.0, 216.0, 214.0, 213.0, 164.0, 210.0, 116.0, 210.0, 211.0, 211.0, 211.0, 223.0, 224.0, 224.0, 223.0, 224.0, 223.0, 223.0, 222.0, 224.0, 222.0, 223.0, 222.0, 226.0, 228.0, 227.0, 223.0, 203.0, 174.0, 213.0, 212.0, 106.0, 200.0, 203.0, 158.0, 211.0, 211.0, 210.0, 93.0, 119.0, 220.0, 221.0, 223.0, 220.0, 219.0, 216.0, 214.0, 109.0, 213.0, 217.0, 220.0, 223.0, 225.0, 220.0, 216.0, 213.0, 212.0, 214.0, 210.0, 213.0, 215.0, 214.0, 212.0, 216.0, 217.0, 215.0, 216.0, 216.0, 45.0, 213.0, 210.0, 177.0, 214.0, 212.0, 200.0, 151.0, 216.0, 212.0, 216.0, 206.0, 193.0, 210.0, 148.0, 215.0, 210.0, 210.0, 200.0, 211.0, 212.0, 168.0, 135.0, 216.0, 164.0, 213.0, 215.0, 210.0, 212.0, 151.0, 214.0, 211.0, 211.0, 168.0, 212.0, 216.0, 90.0, 119.0, 214.0, 215.0, 211.0, 148.0, 213.0, 155.0, 171.0, 151.0, 109.0, 61.0, 197.0, 187.0, 210.0, 210.0, 51.0, 200.0, 145.0, 210.0, 213.0, 210.0, 142.0, 213.0, 211.0, 211.0, 210.0, 161.0, 168.0, 129.0, 129.0, 64.0, 203.0, 132.0, 84.0, 119.0, 106.0, 142.0, 151.0, 161.0, 132.0, 180.0, 122.0, 171.0, 93.0, 64.0, 148.0, 113.0, 67.0, 138.0, 164.0, 145.0, 96.0, 116.0, 84.0, 87.0, 35.0, 67.0, 122.0, 38.0, 109.0, 103.0, 51.0, 71.0, 122.0, 54.0, 58.0, 25.0, 71.0, 48.0, 25.0, 12.0, 58.0, 16.0, 19.0, 32.0, 38.0, 22.0, 29.0, 25.0, 12.0, 19.0, 12.0, 29.0, 29.0, 38.0, 22.0, 22.0, 25.0, 16.0, 19.0, 16.0, 16.0, 16.0, 35.0, 38.0, 12.0, 22.0, 29.0, 16.0, 54.0, 113.0, 12.0, 16.0, 19.0, 48.0, 25.0, 22.0, 16.0, 16.0, 29.0, 16.0, 12.0, 16.0, 12.0, 32.0, 80.0, 138.0, 148.0, 71.0, 211.0, 90.0, 122.0, 132.0, 87.0, 58.0, 126.0, 203.0, 119.0, 177.0, 96.0, 161.0, 93.0, 113.0, 132.0, 80.0, 116.0, 213.0, 213.0, 190.0, 214.0, 230.0, 231.0, 230.0, 230.0, 225.0, 218.0, 222.0, 221.0, 219.0, 218.0, 211.0, 211.0, 51.0, 58.0, 61.0, 32.0, 210.0, 212.0, 212.0, 64.0, 38.0, 22.0, 29.0, 35.0, 35.0, 38.0, 220.0, 229.0, 225.0, 218.0, 223.0, 229.0, 223.0, 223.0, 220.0, 218.0, 219.0, 222.0, 219.0, 80.0, 42.0, 211.0, 218.0, 219.0, 220.0, 220.0, 220.0, 219.0, 219.0, 219.0, 217.0, 213.0, 74.0, 19.0, 77.0, 61.0, 35.0, 38.0, 35.0]

    for a in range(len(A)):
        A[a]=-A[a]-np.pi

    def R(theta):
        # Matrice de rotation dans le sens inverse (peu importe)
        return np.matrix([[np.cos(theta), np.sin(theta)], [-np.sin(theta), np.cos(theta)]])

    points=[Point(A[i],D[i],Q[i]) for i in range(len(A))]
    points_propres=filtre_points(points)                       
    paquets=voisins(50,points_propres)
    paquets_filtres=filtre_paquets(paquets,res)
    balises = trouver_balises(paquets_filtres)
    distances = []
    for b in balises:
        for bb in balises:
            if b!=bb:
                distances.append(distance(b.centre, bb.centre))
    d = min(distances)
    r = sum(distances)/2-d/2
    theta = np.asin(d/2/r)

    rr = R(theta)@np.matrix([[b.centre.x for b in balises], [b.centre.y for b in balises]])
    rr = np.array(rr)
    minx = min(rr[0])
    maxx = max(rr[0])
    miny, maxy = min(rr[1]), max(rr[1])

    X2=[p.x for p in points_propres]
    Y2=[p.y for p in points_propres]
    X3=[p.centre.x for p in paquets]
    Y3=[p.centre.y for p in paquets]
    X4=[p.centre.x for p in balises]
    Y4=[p.centre.y for p in balises]
    X5=[minx, minx, maxx, maxx]
    Y5=[miny, maxy, miny, maxy]
    plt.plot(X2,Y2,"o")
    plt.plot(X3,Y3,"o")
    plt.plot(X4,Y4,"o")
    plt.plot(X5,Y5,"o")
    plt.axis("equal")
    plt.show()